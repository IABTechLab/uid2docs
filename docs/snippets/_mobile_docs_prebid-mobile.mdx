import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

This section is for participants who would like to use [Prebid Mobile SDK](https://prebid.org/product-suite/prebid-mobile/) for header bidding in iOS and Android applications. The UID2 Prebid integration will automatically observe the state of the UID2Identity and whenever it changes, will update Prebidâ€™s external user ids. This includes when an identity is refreshed, resulting in a new advertising token. Prebid then sends the UID2 tokens in to the RTB bidstream along with other external user ids that you may set. Note that in order to use Prebid Mobile, you must have a Prebid Server setup. Follow the steps below for the overall integration.

1. Follow the integration guides below to setup Prebid Mobile SDK for Android / iOS.
   - [Prebid SDK Integration for Android](https://docs.prebid.org/prebid-mobile/pbm-api/android/code-integration-android.html)
   - [Prebid SDK Integration for iOS](https://docs.prebid.org/prebid-mobile/pbm-api/ios/code-integration-ios.html)

2. Follow the steps in this guide to [Add the UID2 Mobile SDK to Your Mobile App](#add-the-uid2-mobile-sdk-to-your-mobile-app).

3. Dependency: The UID2 Prebid integration is distributed as a separate module.
   <Tabs groupId="language-selection">
   <TabItem value='android' label='Android'>
   #### Installing with Gradle
   To add this to your project, include the following in your Gradle configuration:
   ```js
   implementation("com.uid2:uid2-android-sdk-prebid:xxx")
   ```
   #### Installing with Maven
   To install with Maven, add the SDK as a dependency in the `pom.xml` file:
   ```xml
   <dependency>
      <groupId>com.uid2</groupId>
      <artifactId>uid2-android-sdk-prebid</artifactId>
      <version>xxx</version>  // TODO change
   </dependency>
   ```
   </TabItem>
   <TabItem value='ios' label='iOS'>
   #### Installing with Package.swift
   To add this to your project, include the following dependency to Package.swift:
   ```js
   dependencies: [
      .package(url: "https://github.com/IABTechLab/uid2-ios-sdk.git", from: "1.2.0"), // TODO change
   ]
   ```
   #### Installing with Xcode
   In the XCode user interface, under Package Dependencies, add the following entry for your apps:
   | Name         | Location                                     | Dependency Rule                         |
   | :----------- | :------------------------------------------- |:----------------------------------------|
   | uid2-ios-sdk | `git@github.com:IABTechLab/uid2-ios-sdk.git` | Up to next major version: 1.2.0 < 2.0.0 |

   #### Installing with CocoaPods

   Add the following entry in your `Podfile`:

   ```
   pod 'UID2', '~> 1.2' // TODO change
   ```
   </TabItem>
   </Tabs>
3. After adding the additional dependency, you will need to configure the integration. This should be done after both the `UID2Manager` is initialised, as well as Prebid itself, as demonstrated as follows:
   <Tabs groupId="language-selection">
   <TabItem value='android' label='Android Kotlin'>
   ```js
   UID2Manager.init(context = this)

   PrebidMobile.initializeSdk(this) { Log.i(TAG, "Prebid: $it") }
   prebid = UID2Prebid().apply {
       initialize()
   }
   ```
   </TabItem>
   <TabItem value='android-java' label='Android Java'>
   ```js
   UID2Manager.init(this);

   PrebidMobile.initializeSdk(this, status -> Log.i(TAG, "Prebid: " + status));

   prebid = new UID2Prebid();
   prebid.initialize();
   ```
   </TabItem>
   <TabItem value='ios' label='iOS'>
   ```js
   // TODO
   ```
   </TabItem>
   </Tabs>
4. As mentioned earlier, the UID2 Prebid integration will periodically update Prebid by setting the relevant external ids when a new identity is generated or existing token has been refreshed. However, this process is destructive which means that if your application utilises external ids from another source, you will need to provide those to the UID2 Prebid integration so that all external IDs are retained while UID2 token is updated. This is done via a callback passed in during initialisation.
   <Tabs groupId="language-selection">
   <TabItem value='android' label='Android Kotlin'>
   ```js
   prebid = UID2Prebid(
       externalUserIdFactory = ::getExternalIds,
   ).apply {
       initialize()
   }
   ```
   </TabItem>
   <TabItem value='android-java' label='Android Java'>
   ```js
   prebid = new UID2Prebid(UID2Manager.getInstance(), () -> getExternalIds());
   prebid.initialize();
   ```
   </TabItem>
   <TabItem value='ios' label='iOS'>
   ```js
   // TODO
   ```
   </TabItem>
   </Tabs>
